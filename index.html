<!doctype html>
<html lang="ur" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Islamic Vocab — Modern Practice</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#f6fff7;--card:#ffffff;--accent:#1b8a4a;--muted:#234d36;--glass:rgba(27,138,74,0.06)}
  html,body{height:100%;margin:0;font-family:'Nunito', 'Noto Nastaliq Urdu', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;direction:rtl;background:var(--bg);color:var(--muted);}
  .wrap{max-width:980px;margin:20px auto;padding:18px}
  .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,0.06)}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  h1{margin:0;color:var(--accent);font-size:20px}
  .meta{font-size:13px;color:#577a5f}
  .rev-table{width:100%;border-collapse:collapse;margin-top:12px}
  .rev-table th,.rev-table td{border-bottom:1px solid #eef7ee;padding:10px;text-align:center}
  .rev-table th{background:var(--glass);color:#124b2f;font-weight:600}
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;box-shadow:0 6px 18px rgba(27,138,74,0.12)}
  .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(27,138,74,0.12)}
  .game-area{margin-top:16px}
  .qcard{background:linear-gradient(180deg,var(--glass),transparent);padding:18px;border-radius:12px}
  .question{font-size:18px;color:#0f5a32;margin-bottom:12px}
  .opts{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .opt{background:white;border-radius:10px;padding:12px;text-align:center;cursor:pointer;border:1px solid #eef7ee;transition:all .14s}
  .opt:hover{transform:translateY(-4px);box-shadow:0 8px 22px rgba(16,120,70,0.06)}
  .opt.correct{background:#e8f8ee;border-color:var(--accent)}
  .opt.wrong{background:#fff1f1;border-color:#e06b6b}
  .status{display:flex;gap:12px;align-items:center;font-size:14px;margin-top:12px;color:#366a47}
  .small{font-size:13px;color:#5b6b5e}
  footer{text-align:center;margin-top:14px;font-size:13px;color:#789a82}
  @media(max-width:700px){.opts{grid-template-columns:1fr} .question{font-size:16px}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Islamic Vocabulary — Modern Practice</h1>
        <div class="meta">روزانہ 10 نئے الفاظ — لیکن آپ مزید مشق کر سکتے ہیں</div>
      </header>

      <!-- Revision Table -->
      <div id="revision" class="rev">
        <div class="small">آج کے منتخب 10 الفاظ — پہلے جائزہ لیں، پھر "Start Game" دبائیں</div>
        <table class="rev-table" id="revTable" aria-live="polite" role="region">
          <thead><tr><th>اردو</th><th>English</th></tr></thead>
          <tbody></tbody>
        </table>
        <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
          <button id="startBtn" class="btn">Start Game</button>
          <button id="moreBtn" class="btn ghost">Practice +10 more (today)</button>
          <div class="small" id="infoText"></div>
        </div>
      </div>

      <!-- Game Area -->
      <div class="game-area" id="gameArea" style="display:none">
        <div class="qcard">
          <div class="question" id="question">Question will appear here</div>
          <div class="opts" id="options" role="list"></div>
          <div class="status">
            <div>سکور: <strong id="score">0</strong></div>
            <div>زندگیاں: <strong id="lives">3</strong></div>
            <div id="progress" class="small"></div>
          </div>
        </div>
      </div>

      <footer>آپ اپنے progress کو reset کر سکتے ہیں (localStorage) — <button id="resetBtn" class="btn ghost">Reset Progress</button></footer>
    </div>
  </div>

<script>
// Modern game logic
async function loadWords(){
  const res = await fetch('words.json');
  const words = await res.json();
  return words;
}

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }

function getStartDate(){
  let sd = localStorage.getItem('iv_startDate');
  if(!sd){ sd = new Date().toISOString(); localStorage.setItem('iv_startDate', sd); }
  return new Date(sd);
}
function dayNumber(startDate){
  const s = new Date(startDate); s.setHours(0,0,0,0);
  const n = new Date(); n.setHours(0,0,0,0);
  const diff = Math.floor((n - s)/(1000*60*60*24));
  return diff + 1;
}

document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(confirm('Reset local progress?')){ localStorage.clear(); location.reload(); }
});

(async function(){
  const words = await loadWords(); // array of {english, urdu}
  const startDate = getStartDate();
  let day = dayNumber(startDate);
  const totalWords = words.length;

  // compute initial range for today
  let perBatch = 10;
  let startIndex = (day-1)*perBatch;
  let endIndex = Math.min(startIndex + perBatch, totalWords);

  // Allow practicing more: store 'extra' in localStorage per day
  const extraKey = 'iv_extra_day_' + day;
  let extra = parseInt(localStorage.getItem(extraKey) || '0', 10);
  endIndex = Math.min(endIndex + extra, totalWords);

  const infoText = document.getElementById('infoText');
  const revTableBody = document.querySelector('#revTable tbody');
  const startBtn = document.getElementById('startBtn');
  const moreBtn = document.getElementById('moreBtn');
  const gameArea = document.getElementById('gameArea');
  const revision = document.getElementById('revision');
  const qEl = document.getElementById('question');
  const optsEl = document.getElementById('options');
  const scoreEl = document.getElementById('score');
  const livesEl = document.getElementById('lives');
  const progressEl = document.getElementById('progress');

  function updateInfo(){
    infoText.textContent = `Day ${day} — Showing words ${startIndex+1} to ${endIndex} of ${totalWords}`;
  }

  function renderRevision(){
    revTableBody.innerHTML = '';
    const todays = words.slice(startIndex, endIndex);
    todays.forEach(w=>{
      const tr = document.createElement('tr');
      const tdU = document.createElement('td'); tdU.textContent = w.urdu;
      const tdE = document.createElement('td'); tdE.textContent = w.english;
      tr.appendChild(tdU); tr.appendChild(tdE);
      revTableBody.appendChild(tr);
    });
  }

  function addMore(){
    if(endIndex >= totalWords) return alert('No more words available.');
    extra += perBatch;
    localStorage.setItem(extraKey, extra);
    endIndex = Math.min(endIndex + perBatch, totalWords);
    renderRevision();
    updateInfo();
  }

  moreBtn.addEventListener('click', ()=>{
    if(confirm('Add 10 more words to practice today?')) addMore();
  });

  updateInfo();
  renderRevision();

  // Prepare question objects only when start is pressed
  startBtn.addEventListener('click', ()=>{
    const todays = words.slice(startIndex, endIndex);
    if(todays.length === 0){ alert('No words for today.'); return; }
    // Build question objects: for each word, choose direction randomly and ensure options language matches
    let qobjs = [];
    todays.forEach(w=>{
      const dir = Math.random() < 0.5 ? 'U2E' : 'E2U';
      qobjs.push({dir, prompt: dir==='U2E' ? w.urdu : w.english, answer: dir==='U2E' ? w.english : w.urdu, base: w});
    });
    qobjs = shuffle(qobjs);
    // Save state per day to allow resume
    const stateKey = 'iv_state_day_' + day;
    const saved = JSON.parse(localStorage.getItem(stateKey) || 'null');
    let state = saved || {index:0, score:0, lives:3};
    let index = state.index, score = state.score, lives = state.lives;

    // show game area
    revision.style.display = 'none';
    gameArea.style.display = 'block';
    scoreEl.textContent = score; livesEl.textContent = lives;

    function pickOptions(correct, lang){
      // lang = 'en' or 'ur' - pick distractors from whole words pool same language
      const pool = lang === 'en' ? words.map(w=>w.english) : words.map(w=>w.urdu);
      const set = new Set([correct]);
      while(set.size < 4){
        set.add(pool[Math.floor(Math.random()*pool.length)]);
      }
      return shuffle(Array.from(set));
    }

    function saveState(){ localStorage.setItem(stateKey, JSON.stringify({index, score, lives})); }

    function renderQuestion(){
      if(lives <= 0){ qEl.textContent = 'گیم ختم — کل دوبارہ کوشش کریں۔'; optsEl.innerHTML = ''; saveState(); return; }
      if(index >= qobjs.length){ qEl.textContent = 'آج کے الفاظ ختم — مبارک ہو!'; optsEl.innerHTML = ''; saveState(); return; }
      const q = qobjs[index];
      if(q.dir === 'U2E'){
        qEl.textContent = `اردو: "${q.prompt}" — صحیح انگریزی منتخب کریں:`;
        const opts = pickOptions(q.answer, 'en');
        renderOptions(opts, q.answer);
      } else {
        qEl.textContent = `English: "${q.prompt}" — صحیح اردو منتخب کریں:`;
        const opts = pickOptions(q.answer, 'ur');
        renderOptions(opts, q.answer);
      }
      progressEl.textContent = `Question ${index+1} of ${qobjs.length}`;
      scoreEl.textContent = score; livesEl.textContent = lives;
    }

    function renderOptions(options, answer){
      optsEl.innerHTML = '';
      options.forEach(opt=>{
        const d = document.createElement('div');
        d.className = 'opt'; d.textContent = opt;
        d.onclick = () => selectAnswer(d, opt, answer);
        optsEl.appendChild(d);
      });
    }

    function selectAnswer(elem, opt, answer){
      [...optsEl.children].forEach(c=>c.onclick = null);
      if(opt === answer){
        elem.classList.add('correct');
        score += 10;
        index++;
        saveState();
        setTimeout(()=>{ renderQuestion(); }, 650);
      } else {
        elem.classList.add('wrong');
        lives -= 1;
        saveState();
        scoreEl.textContent = score; livesEl.textContent = lives;
        setTimeout(()=>{ if(lives>0){ [...optsEl.children].forEach(c=>{ c.onclick = ()=>selectAnswer(c, c.textContent, answer); }); } }, 800);
      }
    }

    // initial render
    renderQuestion();
  });

})(); // end main IIFE
</script>
</body>
</html>
